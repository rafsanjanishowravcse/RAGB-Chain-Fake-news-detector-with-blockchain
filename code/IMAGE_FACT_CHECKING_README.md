# Image-based Fact Checking - Implementation Guide

## Overview

This implementation adds image-based news verification to the existing AI Fact Checker. Users can now upload images containing text (news screenshots, photos, etc.) and the system will:

1. **Extract text** using OCR (Bengali + English support)
2. **Verify the extracted text** using the existing semantic search pipeline
3. **Display results** in both English and original language

## Features Implemented

### âœ… Core Functionality (MVP)
- **Image Upload**: Support for local files and URLs (JPEG, PNG, WebP)
- **OCR Extraction**: EasyOCR (primary) with Tesseract fallback
- **Language Detection**: Automatic Bengali/English detection
- **Text Cleaning**: Noise removal and normalization
- **Integration**: Seamless integration with existing verification pipeline
- **UI Integration**: New "Image" mode in Gradio interface

### ðŸŽ¨ Visual Analysis Features (Phase 2)
- **Image Captioning**: BLIP-2 model for visual content description
- **Image Embeddings**: CLIP embeddings for visual similarity search
- **Perceptual Hashing**: pHash, aHash, dHash for duplicate detection
- **Similar Image Search**: Find visually similar images in the database
- **Combined Analysis**: OCR + visual features for comprehensive verification

### ðŸ”§ Technical Implementation
- **EXIF Normalization**: Auto-rotate images based on orientation data
- **Local Storage**: Organized file storage with metadata tracking
- **Error Handling**: Graceful fallbacks and comprehensive error messages
- **Performance**: Optimized for both accuracy and speed

## Installation

### Prerequisites
- Python 3.8+
- Existing AI Fact Checker setup (API keys configured)

### Quick Setup
```bash
# Navigate to the code directory
cd code/

# Run the installation script
./install_dependencies.sh

# Or install manually:
pip install easyocr>=1.7.0 pytesseract>=0.3.10 opencv-python>=4.8.0 torch>=2.0.0 torchvision>=0.15.0
pip install transformers>=4.30.0 sentence-transformers>=2.2.0 imagehash>=4.3.1 numpy>=1.21.0 scikit-learn>=1.3.0

# Install Tesseract OCR engine (OS-specific)
# macOS: brew install tesseract tesseract-lang
# Ubuntu: sudo apt-get install tesseract-ocr tesseract-ocr-ben tesseract-ocr-eng
```

### Verify Installation
```bash
python test_image_verification.py
```

## Usage

### Starting the Application
```bash
python app.py
```

### Using Image Verification
1. **Select Input Mode**: Choose "Image" from the radio buttons
2. **Upload Image**: Click the image upload area and select your image
3. **Submit**: Click "Submit" to process the image
4. **View Results**: 
   - **OCR Text**: Shows extracted text from the image
   - **Image Caption**: Visual description generated by AI
   - **Visual Analysis**: Summary of visual features and similar images found
   - **Claim**: The processed claim in English
   - **Verification**: Fact-checking results in English and original language

### Supported Image Types
- **Formats**: JPEG, PNG, WebP
- **Sources**: Local files, URLs
- **Content**: Screenshots, photos, scanned documents, social media posts

## File Structure

```
code/
â”œâ”€â”€ image_fact_checker.py      # Core image processing logic
â”œâ”€â”€ app.py                     # Updated Gradio UI
â”œâ”€â”€ test_image_verification.py # Test suite
â”œâ”€â”€ install_dependencies.sh    # Installation script
â”œâ”€â”€ uploaded_images/           # Storage for uploaded images
â”œâ”€â”€ image_metadata/            # JSON metadata files
â””â”€â”€ requirements.txt          # Updated dependencies
```

## API Reference

### ImageFactChecker Class

#### `process_image_upload(image_path_or_url: str) -> Dict`
Processes image upload from file path or URL.
- **Returns**: Metadata dict with file_path, timestamp, dimensions
- **Handles**: EXIF normalization, format validation, storage management

#### `extract_text_from_image(image_path: str) -> Dict`
Extracts text using EasyOCR (primary) or Tesseract (fallback).
- **Returns**: Dict with ocr_text, language, confidence, segments
- **Languages**: Bengali + English detection

#### `verify_image_news(image_input) -> Tuple[str, str, str, str, str, str, int, str]`
Main verification function.
- **Returns**: (claim, verdict_english, verdict_original, ocr_text, caption, visual_summary, credibility_score, classification)
- **Integration**: Uses existing `verify_news()` pipeline

### UI Functions

#### `handle_input(choice, text_input, audio_input, image_input)`
Updated to handle Image mode alongside Text and Audio.

#### `toggle_visibility(selected)`
Updated to show/hide image input component based on selection.

## Configuration

### OCR Settings
- **Primary Engine**: EasyOCR with Bengali + English models
- **Fallback Engine**: Tesseract with ben+eng language packs
- **Confidence Threshold**: 0.3 (filters low-confidence results)
- **GPU Support**: Disabled by default (set `gpu=True` in EasyOCR init for GPU)

### Storage Settings
- **Upload Directory**: `uploaded_images/`
- **Metadata Directory**: `image_metadata/`
- **File Naming**: UUID-based with original extension
- **Retention**: Files stored locally (consider cleanup policies)

## Troubleshooting

### Common Issues

#### "EasyOCR not available"
- **Solution**: Install EasyOCR: `pip install easyocr`
- **Fallback**: System will use Tesseract automatically

#### "No text could be extracted"
- **Causes**: Low-quality image, no text present, OCR failure
- **Solutions**: 
  - Use higher resolution images
  - Ensure text is clearly visible
  - Try different image formats

#### "Tesseract not found"
- **Solution**: Install Tesseract OCR engine for your OS
- **macOS**: `brew install tesseract tesseract-lang`
- **Ubuntu**: `sudo apt-get install tesseract-ocr tesseract-ocr-ben tesseract-ocr-eng`

#### Slow performance on first run
- **Cause**: EasyOCR downloads language models (~100MB)
- **Solution**: Wait for download to complete (one-time setup)

### Performance Tips
- **Image Size**: Resize large images before upload (recommended: <2MB)
- **Text Quality**: Ensure text is clear and not rotated
- **Format**: JPEG works best for photos, PNG for screenshots

## Future Enhancements

The current implementation provides a solid MVP. Future enhancements could include:

### Phase 2: Visual Analysis
- **Image Captioning**: BLIP/CLIP models for visual content description
- **Perceptual Hashing**: Detect duplicate/manipulated images
- **Reverse Image Search**: Find similar images on the web

### Phase 3: Advanced Features
- **Forensic Analysis**: Error Level Analysis (ELA), copy-move detection
- **Face Detection**: Deepfake detection for images with faces
- **Metadata Analysis**: EXIF data verification and GPS masking

### Phase 4: Production Features
- **Background Processing**: Queue-based processing for large volumes
- **Caching**: Redis/Memcached for OCR results
- **Monitoring**: Performance metrics and error tracking
- **Cloud Storage**: S3/Azure integration for scalable storage

## Contributing

When extending the image fact checking functionality:

1. **Maintain Compatibility**: Ensure changes work with existing Text/Audio modes
2. **Error Handling**: Add comprehensive error handling and user feedback
3. **Testing**: Update `test_image_verification.py` with new test cases
4. **Documentation**: Update this README with new features

## License

This implementation extends the existing AI Fact Checker project and follows the same licensing terms.
